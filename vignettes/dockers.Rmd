---
title: "Using IBRAP in docker or singularity"
author: "C H Knight"
date: '2022-09-08'
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/"
)
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done', position = c('bottom', 'right'))
```

# Using IBRAP in containers

IBRAP is dependent on many packages across multiple languages, the installaton can be easily troublshooted on a local machine with sudo rights, howver when you are in an HPC environment without sudo rights it may be troublesome. Therefore, we created a docker image that installs the correct dependencies and versions for IBRAP in essentially a virutal machines. This allows for a smooth installatio of IBRAP and consistent results. Here we focus on singularity which is commonly used in HPC environments and unique to Linux, and Docker (which can be used in Windows and Linux) which is used across all mainstream operating systems. 

## Using IBRAP in Singularity 

Singularity sould be available to users, however if this is not installed then ask the maintainer of the HPC to install it for you since you require sudo rights. Once it is installed, you can continue to download the  

```{bash, eval=F, echo=T}

mkdir ~/IBRAP_container

cd ~/IBRAP_container

singularity pull docker://knight05/ibrap:v1

```

Now they we have downloaded IBRAPs docker container you will have an ibrap.sif in the directory the command was performed You can now use this interactively or you can  submit non-interactive R scripts.IBRAP has also installed a new miniconda environment, you must configure the R session to use this environment using the following: 

```{bash, eval=F, echo=T}

nano ~/.Rprofile

# then type into the file

reticulate::use_condaenv('IBRAP', required = T)

# Then close and save the file and the correct file will be used throughout

```

To use ibrap.sif interactively you can execute the following command:

```{bash, eval=F, echo=T}

singularity shell ~/IBRAP_container/ibrap.sif

```

From here you can move around your HPC as you would normally and activate an R session, the 
